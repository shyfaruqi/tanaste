@namespace Tanaste.Web.Components.Bento

@* A single glassmorphic tile in the BentoGrid.
   GlowColor drives the accent box-shadow; ColSpan/RowSpan control grid placement.
   The element is the card â€” inner content should be padding-only, no extra background. *@

<div class="bento-item @Class" style="@_computedStyle">
    @ChildContent
</div>

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public int             ColSpan      { get; set; } = 1;
    [Parameter] public int             RowSpan      { get; set; } = 1;
    [Parameter] public string          GlowColor    { get; set; } = "#7C4DFF";
    [Parameter] public string?         Class        { get; set; }
    [Parameter] public string?         Style        { get; set; }

    // Compute CSS custom properties for the glow at rest and on hover.
    // Using C#-side rgba() conversion avoids color-mix() browser compat concerns.
    private string _computedStyle =>
        $"grid-column: span {ColSpan}; " +
        $"grid-row:    span {RowSpan}; " +
        $"--bento-glow:       {HexToRgba(GlowColor, 0.22)}; " +
        $"--bento-glow-hover: {HexToRgba(GlowColor, 0.48)}; " +
        $"--bento-border:     {HexToRgba(GlowColor, 0.30)}; " +
        (Style ?? string.Empty);

    private static string HexToRgba(string hex, double alpha)
    {
        try
        {
            hex = hex.TrimStart('#');
            if (hex.Length == 3)
                hex = $"{hex[0]}{hex[0]}{hex[1]}{hex[1]}{hex[2]}{hex[2]}";
            if (hex.Length != 6)
                return $"rgba(124,77,255,{alpha:F2})";

            var r = Convert.ToInt32(hex[..2], 16);
            var g = Convert.ToInt32(hex[2..4], 16);
            var b = Convert.ToInt32(hex[4..6], 16);
            return $"rgba({r},{g},{b},{alpha:F2})";
        }
        catch
        {
            return $"rgba(124,77,255,{alpha:F2})"; // fallback: Tanaste violet
        }
    }
}

<style>
    .bento-item {
        position:               relative;
        min-height:             160px;
        border-radius:          24px;
        overflow:               hidden;

        /* Glassmorphism core */
        background:             rgba(22, 22, 36, 0.55);
        border:                 1px solid rgba(255, 255, 255, 0.08);
        backdrop-filter:        blur(10px);
        -webkit-backdrop-filter: blur(10px);

        /* Dynamic glow driven by --bento-glow (set per-tile from C#) */
        box-shadow:
            0 4px 24px  rgba(0, 0, 0, 0.45),
            0 0  0 1px  rgba(255, 255, 255, 0.04) inset,
            0 8px 32px  var(--bento-glow, rgba(124,77,255,0.22));

        transition:
            box-shadow   0.28s ease,
            border-color 0.28s ease,
            transform    0.20s ease;
    }

    .bento-item:hover {
        transform:    translateY(-3px);
        border-color: var(--bento-border, rgba(124,77,255,0.30));
        box-shadow:
            0 8px 40px  rgba(0, 0, 0, 0.55),
            0 0  0 1px  rgba(255, 255, 255, 0.07) inset,
            0 14px 52px var(--bento-glow-hover, rgba(124,77,255,0.48));
    }
</style>
