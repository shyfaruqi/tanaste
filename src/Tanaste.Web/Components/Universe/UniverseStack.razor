@namespace Tanaste.Web.Components.Universe

@* Asymmetric Bento grid of Hub cards (Section 2.2 of the UI ASD).
   The first (newest) Hub is the hero tile at 2×2; all others are 1×1.
   Each BentoItem glows with its Hub's brand colour.                    *@

@if (Hubs is { Count: > 0 })
{
    <MudText Typo="Typo.h5" Class="mb-4">All Hubs</MudText>

    <BentoGrid Class="@Class">
        @foreach (var (hub, index) in Hubs.Select((h, i) => (h, i)))
        {
            var isHero = index == 0;

            <BentoItem ColSpan="@(isHero ? 2 : 1)"
                       RowSpan="@(isHero ? 2 : 1)"
                       GlowColor="@hub.DominantHexColor">

                <div class="bento-hub-content" @onclick="() => OnHubSelected.InvokeAsync(hub)">

                    @* ── Type badge row ── *@
                    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1" Class="mb-2">
                        <MudIcon Icon="@GetMediaIcon(hub.MediaTypes)"
                                 Style="@($"color: {hub.DominantHexColor}; font-size: 16px;")" />
                        <MudText Typo="Typo.overline"
                                 Style="@($"color: {hub.DominantHexColor}; letter-spacing: 0.1em;")">
                            @hub.MediaTypes
                        </MudText>
                    </MudStack>

                    @* ── Title ── *@
                    <MudText Typo="@(isHero ? Typo.h5 : Typo.h6)" Class="mb-1">
                        @hub.DisplayName
                    </MudText>

                    @* ── Work count ── *@
                    <MudText Typo="Typo.body2" Color="Color.Secondary">
                        @hub.WorkCount @(hub.WorkCount == 1 ? "work" : "works")
                    </MudText>

                    @* ── Date — pushed to bottom *@
                    <MudText Typo="Typo.caption" Color="Color.Tertiary" Class="mt-auto pt-3">
                        Added @hub.CreatedAt.LocalDateTime.ToString("MMM d, yyyy")
                    </MudText>

                </div>
            </BentoItem>
        }
    </BentoGrid>
}
else
{
    <MudPaper Class="pa-8 d-flex flex-column align-center" Elevation="0" Outlined="true">
        <MudIcon Icon="@Icons.Material.Filled.LibraryAdd"
                 Size="Size.Large" Color="Color.Secondary" Class="mb-3" />
        <MudText Typo="Typo.h6" Class="mb-2">Your library is empty</MudText>
        <MudText Typo="Typo.body2" Color="Color.Secondary">
            Configure a watch directory and run a scan to populate your library.
        </MudText>
    </MudPaper>
}

@code {
    [Parameter] public List<HubViewModel>?         Hubs          { get; set; }
    [Parameter] public string?                     Class         { get; set; }
    [Parameter] public EventCallback<HubViewModel> OnHubSelected { get; set; }

    private static string GetMediaIcon(string mediaTypes) => mediaTypes.ToLowerInvariant() switch
    {
        var t when t.Contains("epub")  => Icons.Material.Filled.MenuBook,
        var t when t.Contains("video") => Icons.Material.Filled.VideoFile,
        var t when t.Contains("comic") => Icons.Material.Filled.AutoStories,
        _                              => Icons.Material.Filled.Folder,
    };
}

<style>
    .bento-hub-content {
        height:          100%;
        min-height:      inherit;
        padding:         1.25rem 1.5rem;
        display:         flex;
        flex-direction:  column;
        cursor:          pointer;
        user-select:     none;
    }
</style>
