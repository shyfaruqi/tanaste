@namespace Tanaste.Web.Components.Universe

@* Asymmetric Bento grid of Universe/Hub cards (Section 2.2 of the UI ASD). *@

@if (Hubs is { Count: > 0 })
{
    <MudText Typo="Typo.h5" Class="mb-4">All Hubs</MudText>

    <BentoGrid Class="@Class">
        @foreach (var (hub, index) in Hubs.Select((h, i) => (h, i)))
        {
            @* Alternate between wide (2-col) and narrow (1-col) for bento asymmetry *@
            <BentoItem ColSpan="@(index % 3 == 0 ? 2 : 1)">
                <MudCard Class="universe-card mud-elevation-2 h-100"
                         Style="height: 100%; cursor: pointer;">
                    <MudCardContent Class="pa-4 d-flex flex-column justify-space-between h-100">
                        <div>
                            <MudStack Row="true" AlignItems="AlignItems.Center" Class="mb-2" Spacing="2">
                                <MudIcon Icon="@GetMediaIcon(hub.MediaTypes)"
                                         Color="Color.Primary"
                                         Size="Size.Small" />
                                <MudText Typo="Typo.overline" Color="Color.Primary">
                                    @hub.MediaTypes
                                </MudText>
                            </MudStack>

                            <MudText Typo="Typo.h6" Class="mb-1">@hub.DisplayName</MudText>

                            <MudText Typo="Typo.body2" Color="Color.Secondary">
                                @hub.WorkCount @(hub.WorkCount == 1 ? "work" : "works")
                            </MudText>
                        </div>

                        <MudText Typo="Typo.caption" Color="Color.Tertiary" Class="mt-3">
                            Added @hub.CreatedAt.LocalDateTime.ToString("MMM d, yyyy")
                        </MudText>
                    </MudCardContent>
                </MudCard>
            </BentoItem>
        }
    </BentoGrid>
}
else
{
    <MudPaper Class="pa-8 d-flex flex-column align-center" Elevation="0" Outlined="true">
        <MudIcon Icon="@Icons.Material.Filled.LibraryAdd" Size="Size.Large" Color="Color.Secondary" Class="mb-3" />
        <MudText Typo="Typo.h6" Class="mb-2">Your library is empty</MudText>
        <MudText Typo="Typo.body2" Color="Color.Secondary">
            Configure a watch directory and run a scan to populate your library.
        </MudText>
    </MudPaper>
}

@code {
    [Parameter] public List<HubViewModel>? Hubs  { get; set; }
    [Parameter] public string?             Class { get; set; }

    private static string GetMediaIcon(string mediaTypes) => mediaTypes.ToLowerInvariant() switch
    {
        var t when t.Contains("epub")  => Icons.Material.Filled.MenuBook,
        var t when t.Contains("video") => Icons.Material.Filled.VideoFile,
        var t when t.Contains("comic") => Icons.Material.Filled.AutoStories,
        _                              => Icons.Material.Filled.Folder,
    };
}

<style>
    .universe-card {
        background: rgba(30, 30, 46, 0.70);
        border: 1px solid rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(8px);
        transition: border-color 0.2s ease, transform 0.15s ease;
    }

    .universe-card:hover {
        border-color: rgba(124, 77, 255, 0.50);
        transform: translateY(-2px);
    }
</style>
